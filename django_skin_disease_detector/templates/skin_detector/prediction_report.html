{% load static %}
<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }}</title>
    <style>
        body { font-family: DejaVu Sans, Arial, sans-serif; color: #222; }
        .header { text-align: center; margin-bottom: 20px; }
        .meta { margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        table td { border: 1px solid #ddd; padding: 8px; }
        .warning { background: #fff3cd; padding: 8px; border: 1px solid #ffeeba; }
        .image { text-align: center; margin: 12px 0; }
        img { max-width: 320px; max-height: 320px; }
    </style>
</head>
<body>
    <div class="header">
        <h2>Reporte de Análisis de Piel</h2>
        <p>Predicción #{{ prediction.id }} - {{ prediction.processed_at|date:"d/m/Y H:i" }}</p>
    </div>

    <div class="image">
        {% if prediction.image %}
            <img src="{{ prediction.image.url }}" alt="Imagen analizada" />
        {% endif %}
    </div>

    <table>
        <tr>
            <td><strong>Diagnóstico</strong></td>
            <td>{{ prediction.get_predicted_disease_name }}</td>
        </tr>
        <tr>
            <td><strong>Confianza</strong></td>
            <td>{{ prediction.get_confidence_percentage }}%</td>
        </tr>
        <tr>
            <td><strong>Tiempo de Procesamiento</strong></td>
            <td>{{ prediction.processing_time|default:"N/A" }} segundos</td>
        </tr>
        <tr>
            <td><strong>Dimensiones de imagen</strong></td>
            <td>{{ prediction.image_size|default:"N/A" }}</td>
        </tr>
    </table>

    {% if top_predictions %}
    <h4>Top Predicciones</h4>
    <table>
        <tr><td><strong>Rank</strong></td><td><strong>Clase</strong></td><td><strong>Probabilidad</strong></td></tr>
        {% for p in top_predictions %}
        <tr>
            <td>{{ p.rank }}</td>
            <td>{{ p.spanish }} ({{ p.class_code|upper }})</td>
            <td>{{ p.percentage }}%</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <div class="warning">
        <strong>Advertencia:</strong> Este reporte es solo una herramienta de apoyo. No sustituye la evaluación médica profesional.
    </div>

</body>
</html>
